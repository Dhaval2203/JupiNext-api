generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===================== EMPLOYEE =====================

model Employee {
  id                 Int      @id @default(autoincrement())
  employeeId         String   @unique
  employeeName       String
  password           String
  designation        String
  department         String?
  primaryEmail       String   @unique
  secondaryEmail     String?
  bankName           String?
  bankAccount        String?
  reportingManagerId Int?
  dateOfBirth        DateTime @default(now())
  dateOfJoining      DateTime @default(now())
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())

  // Self relation (manager)
  reportingManager   Employee?  @relation("ReportingManager", fields: [reportingManagerId], references: [id])
  subordinates       Employee[] @relation("ReportingManager")

  resetOtp           String?
  resetOtpExpiry     DateTime?

  // Relations
  timeClocks          TimeClock[]
  adjustmentRequests AttendanceAdjustment[] @relation("EmployeeAdjustments")
  reviewedAdjustments AttendanceAdjustment[] @relation("AdjustmentReviewer")
}

// ===================== TIME CLOCK =====================

model TimeClock {
  id                   Int      @id @default(autoincrement())

  employeeId           String
  workDate             DateTime @db.Date

  startWorkTime        DateTime
  endWorkTime          DateTime?

  totalBreakSeconds    Int      @default(0)
  totalWorkSeconds     Int      @default(0)

  requiredSeconds      Int      @default(28800) // 8 hours
  shortageSeconds      Int      @default(0)

  isLessThan8Hours     Boolean  @default(false)
  hasAdjustmentRequest Boolean  @default(false)

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  employee             Employee @relation(fields: [employeeId], references: [employeeId])
  adjustment           AttendanceAdjustment?

  @@unique([employeeId, workDate])
  @@index([employeeId])
}

// ===================== ATTENDANCE ADJUSTMENT =====================

model AttendanceAdjustment {
  id                     Int      @id @default(autoincrement())

  timeClockId            Int      @unique
  requestedByEmployeeId  String

  requestedSeconds       Int
  startTime              DateTime
  endTime                DateTime

  reason                 String
  comment                String?

  status                 AdjustmentStatus @default(PENDING)

  requestedAt            DateTime @default(now())
  reviewedAt             DateTime?
  reviewedById           Int?

  // Relations (ðŸ”¥ SINGLE LINE â€“ IMPORTANT)
  timeClock   TimeClock @relation(fields: [timeClockId], references: [id])
  requestedBy Employee  @relation("EmployeeAdjustments", fields: [requestedByEmployeeId], references: [employeeId])
  reviewedBy  Employee? @relation("AdjustmentReviewer", fields: [reviewedById], references: [id])

  @@index([requestedByEmployeeId])
  @@index([reviewedById])
  @@index([status])
}

model Job {
  id           Int      @id @default(autoincrement())
  title        String
  department   String
  location     String
  type         String
  experience   String
  description  String
  requirements String[]
  isActive     Boolean  @default(true)
  displayOrder Int      @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


// ===================== ENUM =====================

enum AdjustmentStatus {
  PENDING
  APPROVED
  REJECTED
}
